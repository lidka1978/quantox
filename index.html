 <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Test</title>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBCQYzNgmWVjCuxVJkXaD0vGZTTmLtW_YY&libraries=places&callback=initMap" async defer></script>
    <script type="text/javascript">
var map;
var infowindow;
var map1;
var pyrmont;
var atms;
      
      
      function initMap() {
      		atms = [];
          pyrmont = {lat: -33.867, lng: 151.195};
          
          map = new google.maps.Map(document.getElementById('map'), {
          center: pyrmont,
          zoom: 13
        });

        infowindow = new google.maps.InfoWindow();
     
        // ATM search
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            pyrmont = pos;
            map.setCenter(pos);
            
          // ATM search  
        var service = new google.maps.places.PlacesService(map);
        service.nearbySearch({
          location: pyrmont,
          radius: 8000,
          keyword: 'Telenor',
          type: ['atm']
        }, callback);
        
            
          }, function() {
            handleLocationError(true, infowindow1, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infowindow1, map.getCenter());
        }

      
      }

      function callback(results, status) {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
            createMarker(results[i]);
          }          
        }
      }


      function createMarker(place) {
        var placeLoc = place.geometry.location;
        var dist = 0;
        var marker = new google.maps.Marker({
          map: map, 
          icon: 'https://raw.githubusercontent.com/lidka1978/quantox/master/telenor-pin.png',
          position: placeLoc
        });

				var loc1 = new google.maps.LatLng(pyrmont.lat, pyrmont.lng);
        // var dist = calcDistance(loc1, placeLoc);
				var directionsService = new google.maps.DirectionsService();

          var request = {
            origin      : loc1, // a city, full address, landmark etc
            destination : placeLoc,
            travelMode  : google.maps.DirectionsTravelMode.WALKING
          };

          directionsService.route(request, function(response, status) {
            if ( status == google.maps.DirectionsStatus.OK ) {
              dist = (response.routes[0].legs[0].distance.value); // the distance in metres
              atms.push({'name': place.name, 'distance': dist, 'marker': marker});
            }
            else {
              // oops, there's no route between these two locations
              // every time this happens, a kitten dies
              // so please, ensure your address is formatted properly
              dist = 'NA';
            }
          });

        google.maps.event.addListener(marker, 'click', function() {
          // OVDE MOZE DA SE STAVI SADA SVE U NIZ I DA SE PRIKAZE NA STRANI
          // infowindow.setContent(place.name + ' / ' + dist + ' metara / mala slika' + ' storeFlag ');
          infowindow.setContent('<div><strong>' + place.name + ' / ' + dist + ' metara' + '</strong><br>' +
                // 'Place ID: ' + place.place_id + '<br>' + 
                place.vicinity + '</div>');
          infowindow.open(map, this);
            
        });
      }
      
      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
      }
      
      function test()
      {
        atms.forEach(function(e, index){
              var atm_img = $('<div>').attr('class', 'image');
              $('.tabs').append(
                $('<div>').attr('class','Info').append(
                  $('<div>').attr('class', 'atm').append(atms[index].name)
                ).mouseenter(function() {
                atms[index].marker.setAnimation(google.maps.Animation.BOUNCE);
                    }).mouseleave(function() {
                        atms[index].marker.setAnimation(null);
                    }).append(
                  $('<div>').attr('class', 'dist').append(atms[index].distance)
                ).append(
                  atm_img.append('img')
                ))
            });
            
      }
      
      
      $( window ).on( "load", readyFn );
      
      function readyFn(){
      	test();
        
        var sorting=1;
$(".Header .dist").each(function(){
    $(this).click(function(){
        var cl=$(this).attr("class")
        sorting = sorting == 1 ? -1 : 1 ;        
        $(".Info").detach().sort(function(a,b){
            var str1=$(a).find('.'+cl).text();
            var str2=$(b).find('.'+cl).text();
            var n1 = str1.match(/\d+/)[0]
            var n2 = str2.match(/\d+/)[0]
            if(n1 != '' ){
                return n1*sorting > n2*sorting;
            }else{
                return sorting == 1 ? str1 > str2 : str1 < str2
            }
        }).appendTo($(".Header").parent());
    })
})
      }

    </script>
    <style>
       html,
body {
  height: 100%;
  margin: 0;
  padding: 0;
}

#map,
#list {
  height: 100%;
  float: left;
  width: 50%;
}

.header {
  overflow: hidden;
  border-bottom: 1px solid #CCC;
  background-color: #dddddd;
}

.header a {
  font-weight: bold
}

.Info {
  background-color: #f9f9f9;
  font-size: 14px;
  border-bottom: 1px solid #ccc;
  overflow: hidden;
  padding: 2px 0
}

.Info .itemInfo {
  float: left;
  width: 550px
}

.header .atm,
.Info .atm {
  width: 33%;
  margin-left: 10px;
  float: left;
}

.header .dist,
.Info .dist {
  width: 70px;
  float: left
}

.header .image,
.Info .image {
  width: 80px;
  float: left
}

    </style>
</head>

<body>
<div id="map"></div>
<div id="list">
  <h1>
     Telenor ATM
  </h1>
  <div class='tabs'>
    <div class="header">
      <div class="atm">ATM</div>
      <div class="dist">Distance</div>
      <div class="image">Image</div>
    </div>
  </div>
</div>
</body>

</html> 